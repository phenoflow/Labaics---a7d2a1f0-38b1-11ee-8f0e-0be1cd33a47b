# S Jill Stocks, Evangelos Kontopantelis, Artur Akbarov, Sarah Rodgers, Anthony J Avery, Darren M Aschroft, 2023.

import sys, csv, re

codes = [{"code":"10090","system":"gprdproduct"},{"code":"10102","system":"gprdproduct"},{"code":"10218","system":"gprdproduct"},{"code":"10254","system":"gprdproduct"},{"code":"10321","system":"gprdproduct"},{"code":"1087","system":"gprdproduct"},{"code":"10968","system":"gprdproduct"},{"code":"11198","system":"gprdproduct"},{"code":"11410","system":"gprdproduct"},{"code":"11497","system":"gprdproduct"},{"code":"11588","system":"gprdproduct"},{"code":"11618","system":"gprdproduct"},{"code":"11732","system":"gprdproduct"},{"code":"1236","system":"gprdproduct"},{"code":"1242","system":"gprdproduct"},{"code":"12486","system":"gprdproduct"},{"code":"1259","system":"gprdproduct"},{"code":"1269","system":"gprdproduct"},{"code":"12994","system":"gprdproduct"},{"code":"13037","system":"gprdproduct"},{"code":"13038","system":"gprdproduct"},{"code":"13040","system":"gprdproduct"},{"code":"13181","system":"gprdproduct"},{"code":"13273","system":"gprdproduct"},{"code":"13290","system":"gprdproduct"},{"code":"13815","system":"gprdproduct"},{"code":"1412","system":"gprdproduct"},{"code":"1424","system":"gprdproduct"},{"code":"1426","system":"gprdproduct"},{"code":"14294","system":"gprdproduct"},{"code":"14306","system":"gprdproduct"},{"code":"14321","system":"gprdproduct"},{"code":"14524","system":"gprdproduct"},{"code":"14590","system":"gprdproduct"},{"code":"14700","system":"gprdproduct"},{"code":"14736","system":"gprdproduct"},{"code":"14757","system":"gprdproduct"},{"code":"15165","system":"gprdproduct"},{"code":"1518","system":"gprdproduct"},{"code":"15326","system":"gprdproduct"},{"code":"1537","system":"gprdproduct"},{"code":"1552","system":"gprdproduct"},{"code":"15706","system":"gprdproduct"},{"code":"16018","system":"gprdproduct"},{"code":"16054","system":"gprdproduct"},{"code":"16148","system":"gprdproduct"},{"code":"16151","system":"gprdproduct"},{"code":"16158","system":"gprdproduct"},{"code":"1619","system":"gprdproduct"},{"code":"1642","system":"gprdproduct"},{"code":"16433","system":"gprdproduct"},{"code":"16577","system":"gprdproduct"},{"code":"16584","system":"gprdproduct"},{"code":"1680","system":"gprdproduct"},{"code":"17","system":"gprdproduct"},{"code":"1727","system":"gprdproduct"},{"code":"1734","system":"gprdproduct"},{"code":"1741","system":"gprdproduct"},{"code":"17465","system":"gprdproduct"},{"code":"17590","system":"gprdproduct"},{"code":"17654","system":"gprdproduct"},{"code":"17670","system":"gprdproduct"},{"code":"1794","system":"gprdproduct"},{"code":"18394","system":"gprdproduct"},{"code":"18537","system":"gprdproduct"},{"code":"18848","system":"gprdproduct"},{"code":"19031","system":"gprdproduct"},{"code":"19121","system":"gprdproduct"},{"code":"19376","system":"gprdproduct"},{"code":"19389","system":"gprdproduct"},{"code":"19401","system":"gprdproduct"},{"code":"1951","system":"gprdproduct"},{"code":"1952","system":"gprdproduct"},{"code":"20825","system":"gprdproduct"},{"code":"2092","system":"gprdproduct"},{"code":"21005","system":"gprdproduct"},{"code":"2125","system":"gprdproduct"},{"code":"2148","system":"gprdproduct"},{"code":"21482","system":"gprdproduct"},{"code":"2160","system":"gprdproduct"},{"code":"2224","system":"gprdproduct"},{"code":"2229","system":"gprdproduct"},{"code":"2282","system":"gprdproduct"},{"code":"23741","system":"gprdproduct"},{"code":"2440","system":"gprdproduct"},{"code":"24898","system":"gprdproduct"},{"code":"25204","system":"gprdproduct"},{"code":"25784","system":"gprdproduct"},{"code":"2600","system":"gprdproduct"},{"code":"26063","system":"gprdproduct"},{"code":"2655","system":"gprdproduct"},{"code":"26616","system":"gprdproduct"},{"code":"27188","system":"gprdproduct"},{"code":"2723","system":"gprdproduct"},{"code":"27505","system":"gprdproduct"},{"code":"27679","system":"gprdproduct"},{"code":"28073","system":"gprdproduct"},{"code":"2850","system":"gprdproduct"},{"code":"2851","system":"gprdproduct"},{"code":"28640","system":"gprdproduct"},{"code":"28761","system":"gprdproduct"},{"code":"2892","system":"gprdproduct"},{"code":"2893","system":"gprdproduct"},{"code":"29325","system":"gprdproduct"},{"code":"2951","system":"gprdproduct"},{"code":"2978","system":"gprdproduct"},{"code":"30118","system":"gprdproduct"},{"code":"3018","system":"gprdproduct"},{"code":"30210","system":"gprdproduct"},{"code":"30238","system":"gprdproduct"},{"code":"30649","system":"gprdproduct"},{"code":"3075","system":"gprdproduct"},{"code":"3119","system":"gprdproduct"},{"code":"3150","system":"gprdproduct"},{"code":"31774","system":"gprdproduct"},{"code":"32874","system":"gprdproduct"},{"code":"3289","system":"gprdproduct"},{"code":"3297","system":"gprdproduct"},{"code":"33258","system":"gprdproduct"},{"code":"3363","system":"gprdproduct"},{"code":"33817","system":"gprdproduct"},{"code":"33849","system":"gprdproduct"},{"code":"34310","system":"gprdproduct"},{"code":"34315","system":"gprdproduct"},{"code":"34428","system":"gprdproduct"},{"code":"34739","system":"gprdproduct"},{"code":"34794","system":"gprdproduct"},{"code":"34859","system":"gprdproduct"},{"code":"34919","system":"gprdproduct"},{"code":"35071","system":"gprdproduct"},{"code":"35106","system":"gprdproduct"},{"code":"35107","system":"gprdproduct"},{"code":"35113","system":"gprdproduct"},{"code":"35118","system":"gprdproduct"},{"code":"35165","system":"gprdproduct"},{"code":"35225","system":"gprdproduct"},{"code":"35288","system":"gprdproduct"},{"code":"35293","system":"gprdproduct"},{"code":"35299","system":"gprdproduct"},{"code":"35374","system":"gprdproduct"},{"code":"35392","system":"gprdproduct"},{"code":"35408","system":"gprdproduct"},{"code":"35430","system":"gprdproduct"},{"code":"35461","system":"gprdproduct"},{"code":"35503","system":"gprdproduct"},{"code":"35510","system":"gprdproduct"},{"code":"35542","system":"gprdproduct"},{"code":"3556","system":"gprdproduct"},{"code":"35580","system":"gprdproduct"},{"code":"35602","system":"gprdproduct"},{"code":"35611","system":"gprdproduct"},{"code":"35631","system":"gprdproduct"},{"code":"35638","system":"gprdproduct"},{"code":"35652","system":"gprdproduct"},{"code":"3570","system":"gprdproduct"},{"code":"35700","system":"gprdproduct"},{"code":"35724","system":"gprdproduct"},{"code":"35725","system":"gprdproduct"},{"code":"35772","system":"gprdproduct"},{"code":"35825","system":"gprdproduct"},{"code":"35905","system":"gprdproduct"},{"code":"35986","system":"gprdproduct"},{"code":"36021","system":"gprdproduct"},{"code":"36090","system":"gprdproduct"},{"code":"36290","system":"gprdproduct"},{"code":"36401","system":"gprdproduct"},{"code":"36462","system":"gprdproduct"},{"code":"37432","system":"gprdproduct"},{"code":"37447","system":"gprdproduct"},{"code":"37470","system":"gprdproduct"},{"code":"38","system":"gprdproduct"},{"code":"38079","system":"gprdproduct"},{"code":"38136","system":"gprdproduct"},{"code":"38214","system":"gprdproduct"},{"code":"38226","system":"gprdproduct"},{"code":"39099","system":"gprdproduct"},{"code":"39102","system":"gprdproduct"},{"code":"3947","system":"gprdproduct"},{"code":"39879","system":"gprdproduct"},{"code":"3989","system":"gprdproduct"},{"code":"3993","system":"gprdproduct"},{"code":"40057","system":"gprdproduct"},{"code":"4131","system":"gprdproduct"},{"code":"41412","system":"gprdproduct"},{"code":"42830","system":"gprdproduct"},{"code":"42858","system":"gprdproduct"},{"code":"42886","system":"gprdproduct"},{"code":"42928","system":"gprdproduct"},{"code":"42985","system":"gprdproduct"},{"code":"42994","system":"gprdproduct"},{"code":"43074","system":"gprdproduct"},{"code":"4365","system":"gprdproduct"},{"code":"43738","system":"gprdproduct"},{"code":"43893","system":"gprdproduct"},{"code":"44064","system":"gprdproduct"},{"code":"4499","system":"gprdproduct"},{"code":"454","system":"gprdproduct"},{"code":"4545","system":"gprdproduct"},{"code":"45610","system":"gprdproduct"},{"code":"4665","system":"gprdproduct"},{"code":"4688","system":"gprdproduct"},{"code":"4759","system":"gprdproduct"},{"code":"47638","system":"gprdproduct"},{"code":"47943","system":"gprdproduct"},{"code":"4801","system":"gprdproduct"},{"code":"4803","system":"gprdproduct"},{"code":"48340","system":"gprdproduct"},{"code":"4842","system":"gprdproduct"},{"code":"48490","system":"gprdproduct"},{"code":"48519","system":"gprdproduct"},{"code":"48547","system":"gprdproduct"},{"code":"48666","system":"gprdproduct"},{"code":"48709","system":"gprdproduct"},{"code":"48741","system":"gprdproduct"},{"code":"4926","system":"gprdproduct"},{"code":"49367","system":"gprdproduct"},{"code":"49412","system":"gprdproduct"},{"code":"49591","system":"gprdproduct"},{"code":"49711","system":"gprdproduct"},{"code":"49772","system":"gprdproduct"},{"code":"49868","system":"gprdproduct"},{"code":"50036","system":"gprdproduct"},{"code":"50051","system":"gprdproduct"},{"code":"50129","system":"gprdproduct"},{"code":"50503","system":"gprdproduct"},{"code":"50557","system":"gprdproduct"},{"code":"50689","system":"gprdproduct"},{"code":"50956","system":"gprdproduct"},{"code":"51209","system":"gprdproduct"},{"code":"51270","system":"gprdproduct"},{"code":"5170","system":"gprdproduct"},{"code":"51815","system":"gprdproduct"},{"code":"5223","system":"gprdproduct"},{"code":"52410","system":"gprdproduct"},{"code":"53057","system":"gprdproduct"},{"code":"5309","system":"gprdproduct"},{"code":"53297","system":"gprdproduct"},{"code":"54742","system":"gprdproduct"},{"code":"5516","system":"gprdproduct"},{"code":"5521","system":"gprdproduct"},{"code":"5522","system":"gprdproduct"},{"code":"5558","system":"gprdproduct"},{"code":"5580","system":"gprdproduct"},{"code":"56462","system":"gprdproduct"},{"code":"56471","system":"gprdproduct"},{"code":"56475","system":"gprdproduct"},{"code":"56477","system":"gprdproduct"},{"code":"56478","system":"gprdproduct"},{"code":"56484","system":"gprdproduct"},{"code":"56493","system":"gprdproduct"},{"code":"56499","system":"gprdproduct"},{"code":"5683","system":"gprdproduct"},{"code":"57249","system":"gprdproduct"},{"code":"5740","system":"gprdproduct"},{"code":"57524","system":"gprdproduct"},{"code":"57525","system":"gprdproduct"},{"code":"57544","system":"gprdproduct"},{"code":"57579","system":"gprdproduct"},{"code":"57589","system":"gprdproduct"},{"code":"57694","system":"gprdproduct"},{"code":"5804","system":"gprdproduct"},{"code":"5822","system":"gprdproduct"},{"code":"58269","system":"gprdproduct"},{"code":"5864","system":"gprdproduct"},{"code":"5885","system":"gprdproduct"},{"code":"59409","system":"gprdproduct"},{"code":"5942","system":"gprdproduct"},{"code":"5992","system":"gprdproduct"},{"code":"6462","system":"gprdproduct"},{"code":"6526","system":"gprdproduct"},{"code":"6569","system":"gprdproduct"},{"code":"6616","system":"gprdproduct"},{"code":"6746","system":"gprdproduct"},{"code":"6796","system":"gprdproduct"},{"code":"6938","system":"gprdproduct"},{"code":"7017","system":"gprdproduct"},{"code":"7133","system":"gprdproduct"},{"code":"719","system":"gprdproduct"},{"code":"7268","system":"gprdproduct"},{"code":"7270","system":"gprdproduct"},{"code":"7356","system":"gprdproduct"},{"code":"7602","system":"gprdproduct"},{"code":"7638","system":"gprdproduct"},{"code":"7653","system":"gprdproduct"},{"code":"7724","system":"gprdproduct"},{"code":"7788","system":"gprdproduct"},{"code":"7891","system":"gprdproduct"},{"code":"7948","system":"gprdproduct"},{"code":"7964","system":"gprdproduct"},{"code":"8111","system":"gprdproduct"},{"code":"8433","system":"gprdproduct"},{"code":"8635","system":"gprdproduct"},{"code":"882","system":"gprdproduct"},{"code":"883","system":"gprdproduct"},{"code":"896","system":"gprdproduct"},{"code":"909","system":"gprdproduct"},{"code":"910","system":"gprdproduct"},{"code":"911","system":"gprdproduct"},{"code":"9164","system":"gprdproduct"},{"code":"9233","system":"gprdproduct"},{"code":"947","system":"gprdproduct"},{"code":"9477","system":"gprdproduct"},{"code":"9571","system":"gprdproduct"},{"code":"959","system":"gprdproduct"},{"code":"9599","system":"gprdproduct"},{"code":"9711","system":"gprdproduct"},{"code":"9921","system":"gprdproduct"}];
REQUIRED_CODES = 1;
with open(sys.argv[1], 'r') as file_in, open('labaics-potential-cases.csv', 'w', newline='') as file_out:
    csv_reader = csv.DictReader(file_in)
    csv_writer = csv.DictWriter(file_out, csv_reader.fieldnames + ["labaics-p2-10microgram---primary-identified"])
    csv_writer.writeheader();
    codes_identified = 0;
    for row in csv_reader:
        newRow = row.copy();
        for cell in row:
            # Iterate cell lists (e.g. codes)
            for item in re.findall(r'\(([^,]*)\,', row[cell]):
                if(item in list(map(lambda code: code['code'], codes))): codes_identified+=1;
                if(codes_identified>=REQUIRED_CODES):
                    newRow["labaics-p2-10microgram---primary-identified"] = "CASE";
                    break;
            if(codes_identified>=REQUIRED_CODES): break;
        if(codes_identified<REQUIRED_CODES):
            newRow["labaics-p2-10microgram---primary-identified"] = "UNK";
        codes_identified=0;
        csv_writer.writerow(newRow)
